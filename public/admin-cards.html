<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Cards — Udderly the Same</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; max-width:900px; margin:40px auto; background:#f9f9f9; }
    h1 { text-align:center; margin-bottom:20px; }
    input,button { font-size:16px; padding:8px; margin:6px 0; }
    #questionText { width:70%; max-width:700px; display:inline-block; }
    #addBtn { display:inline-block; margin-left:8px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    th,td { border:1px solid #ccc; padding:8px; text-align:left; }
    th { background:#eee; }
    .btn { background:#333; color:#fff; padding:8px 12px; border-radius:6px; text-decoration:none; display:inline-block; margin-bottom:16px; }
    .btn:hover { background:#F7AC4D; }
    .action-btn { font-size:14px; padding:4px 8px; border:none; border-radius:4px; cursor:pointer; }
    .edit-btn { background:#2e7d32; color:#fff; }
    .edit-btn:hover { background:#388e3c; }
    .delete-btn { background:#c62828; color:#fff; }
    .delete-btn:hover { background:#e53935; }
    .actions { display:flex; gap:8px; } /* ensures buttons are side by side */
    .bottom-bar { margin-top:30px; text-align:center; }
    .header {
      display: flex;
      align-items: center;   /* vertically center logo and text */
      gap: 12px;             /* small horizontal space between logo and heading */
      margin-bottom: 20px;   /* space below the header bar */
    }
    .logo {
      max-width: 100px;       /* smaller logo size so it fits nicely */
      height: auto;
      display: block;
    }
  </style>
</head>
<body>
  <!-- Logo at the top -->
  <div class="header">
    <img src="udder-consensus-logo.png" alt="Udderly the Same Logo" class="logo">
    <h1>Card Management</h1>
  </div>

  <a class="btn" href="/admin-dashboard.html">← Back to Dashboard</a>

  <div>
    <input id="questionText" placeholder="New question text" />
    <button id="addBtn">Add Question</button>
  </div>
  <table id="cardsTable">
    <thead>
      <tr><th>ID</th><th>Question</th><th>Sort Number</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="bottom-bar">
    <a class="btn" href="/admin-dashboard.html">← Back to Dashboard</a>
  </div>

  <script>
    let editingId = null;

    async function loadQuestions(){
      const res = await fetch('/api/questions');
      const qs = await res.json();
      document.querySelector('#cardsTable tbody').innerHTML = qs.map(q =>
        `<tr>
          <td>${q.id}</td>
          <td>${escapeHTML(q.prompt)}</td>
          <td>${q.sort_number || q.id}</td>
          <td>
            <div class="actions">
              <button class="action-btn edit-btn" onclick="editQuestion(${q.id}, '${escapeHTML(q.prompt)}')">Edit</button>
              <button class="action-btn delete-btn" onclick="deleteQuestion(${q.id})">Delete</button>
            </div>
          </td>
        </tr>`
      ).join('');
    }

    document.getElementById('addBtn').onclick = async () => {
      const text = document.getElementById('questionText').value.trim();
      if (!text) return alert('Enter a question');

      if (editingId) {
        const res = await fetch(`/api/questions/${editingId}`, {
          method:'PUT',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({ text })
        });
        if (res.ok) {
          editingId = null;
          document.getElementById('questionText').value='';
          document.getElementById('addBtn').textContent = 'Add Question';
          loadQuestions();
        } else {
          alert('Failed to update question');
        }
      } else {
        const res = await fetch('/api/questions', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({ text })
        });
        if (res.ok) {
          document.getElementById('questionText').value='';
          loadQuestions();
        } else {
          alert('Failed to add question');
        }
      }
    };

    function editQuestion(id, text) {
      document.getElementById('questionText').value = text;
      editingId = id;
      document.getElementById('addBtn').textContent = 'Update Question';
    }

    async function deleteQuestion(id) {
      if (!confirm('Are you sure you want to delete this question?')) return;
      const res = await fetch(`/api/questions/${id}`, { method:'DELETE' });
      if (res.ok) {
        loadQuestions();
      } else {
        alert('Failed to delete question');
      }
    }

    function escapeHTML(str){
      const div=document.createElement('div');
      div.innerText=String(str||"");
      return div.innerHTML;
    }

    loadQuestions();
  </script>
</body>
</html>
