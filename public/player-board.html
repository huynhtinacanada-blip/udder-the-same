<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Player Dashboard ‚Äî Udderly the Same</title>
  <script src="/socket.io/socket.io.js"></script>

  <style>
    /* ---- Page Body ---- */
    body {
      font-family:'Segoe UI',Arial,sans-serif;
      max-width:900px;
      margin:30px auto;
      background:linear-gradient(135deg,#fdfcfb,#e2d1c3);
      padding:20px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    .header { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
    .logo { max-width:100px; height:auto; display:block; }
    h2 { margin:0; }
    #statusMessage { font-weight:bold; margin-top:10px; text-align:center; color:#444; }
    button {
      padding:10px 18px; margin:6px; font-size:16px; border:none; border-radius:8px;
      cursor:pointer; background:#333; color:#fff; transition:background 0.3s ease;
    }
    button:disabled { background:#999; cursor:not-allowed; }
    button:hover:enabled { background:#F7AC4D; }
    .danger-btn:hover:enabled { background:#d32f2f; color:#fff; font-weight:bold; }
    #showQuestionBtn:hover:enabled { background:#1976d2; }
    #showAnswersBtn:hover:enabled { background:#2e7d32; }
    #signOutBtn {
      background-color: #d32f2f; color: white; border: none; padding: 10px 18px;
      border-radius: 6px; cursor: pointer; font-weight: bold; transition: background-color 0.3s;
    }
    #signOutBtn:hover { background-color: #ffa600; }
    .accordion { margin-top:20px; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .accordion-header { background:#333; color:#fff; padding:12px; cursor:pointer; font-weight:bold; }
    .accordion-header:hover { background:#F7AC4D; }
    .accordion-content { max-height:0; overflow:hidden; transition:max-height 0.4s ease; background:#fff; padding:0 15px; }
    .accordion-content.open { padding:15px; max-height:1000px; }
    #answersTable, #playersTable, #scoreTable {
      font-size:18px; border-collapse:collapse; width:100%; margin-top:10px;
    }
    #answersTable th, #answersTable td,
    #playersTable th, #playersTable td,
    #scoreTable th, #scoreTable td {
      border-bottom:1px solid #ccc; padding:8px;
    }
    #answersTable th, #answersTable td { text-align:left; }
    #answersTable th:first-child, #answersTable td:first-child { width: 120px; text-align: left; }
    #answersTable th:nth-child(2), #answersTable td:nth-child(2) { width: 200px; }
    #answersTable th:nth-child(3), #answersTable td:nth-child(3) { width: auto; }
    #answersTable th { text-align: left !important; }
    textarea {
      width:100%; max-width:800px; padding:10px; border-radius:6px;
      border:1px solid #ccc; margin-bottom:10px; font-size:16px;
    }
    #gameOverBanner {
      background-color: #d32f2f; color: white; font-weight: bold;
      text-align: center; padding: 25px; font-size: 22px;
      margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .hidden { display: none; }
    .disclaimer { text-align:center; font-size:0.75em; color:#666; margin-top:50px; }
    .popup {
      display:none; position:fixed; z-index:1000; left:0; top:0;
      width:100%; height:100%; background:rgba(0,0,0,0.6);
      backdrop-filter:blur(4px); justify-content:center; align-items:center;
    }
    .popup-content {
      background:#fff; border-radius:16px; padding:40px; width:80%; max-width:700px;
      text-align:center; box-shadow:0 8px 24px rgba(0,0,0,0.3); animation:fadeIn 0.4s ease;
      position:relative;
    }
    .popup-content h1 { font-size:2rem; color:#333; margin:0; }
    .close-btn { position:absolute; top:20px; right:30px; font-size:32px; font-weight:bold; color:#333; cursor:pointer; transition:color 0.3s; }
    .close-btn:hover { color:#F7AC4D; }
    @keyframes fadeIn { from { transform:scale(0.9); opacity:0; } to { transform:scale(1); opacity:1; } }
  </style>
</head>
<body>
  <div class="header">
    <img src="udderly-logo-main-b.png" alt="Udderly the Same Logo" class="logo">
    <h2>üêÆ Player Dashboard <span class="small">(code ver. 1.1.5r)</span></h2>
    <button id="endGameBtn" class="danger-btn" style="margin-left:auto;">End Game</button>
  </div>

  <div id="gameOverBanner" class="hidden">üéÆ Game Over</div>

  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion('questionBox')">Game Room Info</div>
    <div id="questionBox" class="accordion-content open">
      <div class="roomHeader">
        <p id="roomLabel"></p>
        <span id="topStatus"></span>
      </div>
      <table id="playersTable">
        <thead><tr><th>Player</th><th>Out</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
      <div id="controls">
        <button id="startBtn">Start Round</button>
        <button id="showQuestionBtn">Show Question</button>
        <button id="showAnswersBtn" disabled>Show Answers</button>
        <p id="statusMessage"></p>
      </div>
      <div id="qaSection" style="display:none;">
        <p id="questionPrompt"></p>
        <textarea id="answerInput" rows="2" placeholder="Type your answer..."></textarea>
        <button id="submitAnswerBtn">Submit Answer</button>
        <p id="progress"></p>
      </div>
    </div>
  </div>

  <div id="answersAccordion" class="accordion" style="display:none;">
    <div class="accordion-header" onclick="toggleAccordion('answersTableWrapper')">Answers</div>
    <div id="answersTableWrapper" class="accordion-content">
      <table id="answersTable">
        <thead><tr><th>Point</th><th>TAG</th><th>Name</th><th>Answer</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion('scoreboardBox')">Scoreboard</div>
    <div id="scoreboardBox" class="accordion-content">
      <div class="table-wrapper">
        <table id="scoreTable">
          <thead></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="roundPopup" class="popup">
    <div class="popup-content">
      <span id="closePopup" class="close-btn">&times;</span>
      <h1 id="popupQuestion"></h1>
    </div>
  </div>

  <div class="disclaimer">
    This online game is inspired by Herd Mentality, created by Big Potato Games. 
    It is an independent project and is not affiliated with, endorsed by, or sponsored by Big Potato Games.
  </div>


  <!-- ---- JavaScript Section ---- -->
  <!-- Best practice: organize JavaScript code into four groups in this order:
       1. Setup (global flags, DOM references, socket connection)
       2. Events (user‚Äëinitiated actions like button clicks and switch toggles)
       3. Server responses (socket listeners that react to server messages)
       4. Helpers (utility functions used by the above)

       The current file does not yet follow this grouping because the code was written incrementally:
       - Event handlers and socket listeners were added as features were built,
       - Utility functions were defined inline when needed,
       - As a result, related blocks are scattered instead of grouped. -->
  <script>
// Connect to server via socket.io
const socket = io("https://udder-the-same.onrender.com");

// üëá Debug: confirm socket connection
socket.on("connect", () => {
  console.log("Socket connected with ID:", socket.id);
});

// üëá Debug: listen for connection errors
socket.on("connect_error", (err) => {
  console.error("Socket connection error:", err);
  // Redirect to a custom error page
  window.location.href = "/error.html";
});

// üëá Debug: listen for disconnection
socket.on("disconnect", (reason) => {
  console.warn("Socket disconnected:", reason);
  // Redirect if disconnected unexpectedly
  if (reason !== "io client disconnect") {
    window.location.href = "/error.html";
  }
});
    // ---- Helpers ----
    // Escape HTML to prevent injection attacks
    function escapeHTML(str){
      const div=document.createElement('div');
      div.innerText=String(str||"");
      return div.innerHTML;
    }
    function toggleAccordion(id){document.getElementById(id).classList.toggle("open");}
    function openAccordion(id){document.getElementById(id).classList.add("open");}
    function closeAccordion(id){document.getElementById(id).classList.remove("open");}

    // ---- Setup ----
    let roomIsClosed = false;
    const urlParams = new URLSearchParams(window.location.search);
    const roomCode = (urlParams.get("room") || "").toUpperCase();
    const myName = urlParams.get("name") || "";

    // üëá Debug: print values to console
    console.log("URL params:", window.location.search);
    console.log("Extracted roomCode:", roomCode);
    console.log("Extracted myName:", myName);

    if (!roomCode || !myName) {
      console.warn("Missing roomCode or myName, redirecting to login page");
      window.location.href = "/player-login.html";
    }

    document.getElementById("roomLabel").innerText =
      `Room: ${escapeHTML(roomCode)} ‚Äî Hello: ${escapeHTML(myName)}`;

    const socket = io();

    // üëá Debug: confirm socket connection
    socket.on("connect", () => {
      console.log("Socket connected with ID:", socket.id);
    });

    // üëá Debug: log what you‚Äôre emitting
    console.log("Emitting joinLobby with:", { roomCode, name: myName });
    socket.emit("joinLobby", { roomCode, name: myName });

    // üëá Debug: listen for errors from server
    socket.on("joinError", (data) => {
      console.error("Join error from server:", data);
    });

    // Cache DOM references
    const startBtn = document.getElementById("startBtn");
    const showBtn = document.getElementById("showAnswersBtn");
    const showQuestionBtn = document.getElementById("showQuestionBtn");
    const statusMessage = document.getElementById("statusMessage");
    const submitBtn = document.getElementById("submitAnswerBtn");
    const inputBox = document.getElementById("answerInput");
    const endGameBtn = document.getElementById("endGameBtn");
    const signOutBtn = document.getElementById("signOutBtn");

    // ---- Events ----
    signOutBtn.onclick = () => window.location.href = "/player-login.html";
    endGameBtn.onclick = () => {
      if (confirm("Are you sure you want to end this game?")) {
        socket.emit("closeRoom", { roomCode });
      }
    };

    // ---- Server responses ----
    socket.on("roomClosed", () => {
      roomIsClosed = true;
      startBtn.disabled = true;
      showBtn.disabled = true;
      showQuestionBtn.disabled = true;
      submitBtn.disabled = true;
      inputBox.disabled = true;
      endGameBtn.disabled = true;
      document.getElementById("gameOverBanner").classList.remove("hidden");
      statusMessage.innerText = "üéÆ This game room has been closed.";
    });
	
     // ---- Player State Tracking ----
    // Keep track of all players, whether answers are shown, current round number, and scoreboard data.
    let allPlayers = new Set();
    let answersShown = false;
    let currentRound = 0;
    let scoreboard = []; // server-sourced [{player_name, total, rounds:{round:points}}]

    // ---- Switch Overrides ----
    // Each toggle switch enables/disables its corresponding control button.
    document.getElementById("toggleStart").addEventListener("change", e => {
      startBtn.disabled = !e.target.checked;
    });
    document.getElementById("toggleShow").addEventListener("change", e => {
      showBtn.disabled = !e.target.checked;
    });
    document.getElementById("toggleSubmit").addEventListener("change", e => {
      const on = e.target.checked;
      submitBtn.disabled = !on;
      inputBox.disabled = !on;
    });

    // ---- Player List Updates ----
    // Server sends updated player list. Render table rows with player name, ghost icon if inactive, and submission status.
    socket.on("playerList", data => {
      const players = data.players || data;
      const activeCount = data.activeCount || players.filter(p => p.active).length;
      const submittedCount = data.submittedCount || players.filter(p => p.active && p.submitted).length;

      players.forEach(p => allPlayers.add(p.name));
      document.querySelector("#playersTable tbody").innerHTML = Array.from(allPlayers)
        .map(name => {
          const player = players.find(p => p.name === name);
          const ghost = player && player.active ? "" : "üëª"; // ghost icon if inactive
          const submitted = player ? (player.submitted ? "üü¢ Submitted" : "‚åõ Waiting") : "";
          return `<tr><td>${escapeHTML(name)}</td><td>${ghost}</td><td>${submitted}</td></tr>`;
        })
        .join("");

      // If QA section is visible, update progress message
      if (document.getElementById("qaSection").style.display === "block") {
        document.getElementById("progress").innerText = `Submitted: ${escapeHTML(submittedCount)} / ${escapeHTML(totalPlayers)}`;

      }
    });

    // ---- Submission Progress ----
    // Server sends submission counts. Enable Show Answers only when all players submitted.
    socket.on("submissionProgress", ({submittedCount,totalPlayers}) => {
      document.getElementById("progress").innerText = `Submitted: ${escapeHTML(submittedCount)} / ${escapeHTML(totalPlayers)}`;
      if (totalPlayers > 0 && submittedCount === totalPlayers) {
        showBtn.disabled = false;
        document.getElementById("toggleShow").checked = true;
      } else {
        showBtn.disabled = true;
        document.getElementById("toggleShow").checked = false;
      }
    });

    // ---- Start Round ----
    // Clicking Start Round tells server to begin a new round.
    startBtn.onclick = () => {
      socket.emit("startRound",{roomCode});
    };

    // ---- Round Started ----
    // Server signals a new round has begun. Update UI accordingly.
    socket.on("roundStarted", ({questionId,prompt,playerCount,roundNumber,myAnswer}) => {
      currentRound = roundNumber;  // this is the only place to update the round number
      answersShown = false;

      // Disable Start and Show buttons until round progresses
      startBtn.disabled=true;
      document.getElementById("toggleStart").checked = false;
      showBtn.disabled=true;
      document.getElementById("toggleShow").checked = false;

      // Show QA section with question prompt
      statusMessage.innerText="Round in progress‚Ä¶";
      document.getElementById("qaSection").style.display="block";
      openAccordion("questionBox");
      closeAccordion("answersTableWrapper");
      document.getElementById("answersAccordion").style.display="none";
      document.getElementById("questionPrompt").innerText = `Round ${roundNumber}: ${escapeHTML(prompt)}`;  //Ensure we always use escape any dynamic text inserted into statusMessage or other DOM elements to prevent injection.
      document.getElementById("progress").innerText = `Submitted: 0 / ${escapeHTML(playerCount)}`;

// Show popup with question
const promptText = document.getElementById("questionPrompt").innerText;
document.getElementById("popupQuestion").innerText = escapeHTML(promptText);
document.getElementById("roundPopup").style.display = "flex";

      // Keep local Show Question toggle enabled
      showQuestionBtn.disabled = false;

      // ---- Answer Submission Logic ----
      // If answers already shown or player has submitted, disable input. Otherwise allow submission.
      if (answersShown || myAnswer) {
        submitBtn.disabled=true;
        inputBox.disabled=true;
        document.getElementById("toggleSubmit").checked = false;
        inputBox.value = myAnswer || "";
      } else {
        submitBtn.disabled=false;
        inputBox.disabled=false;
        document.getElementById("toggleSubmit").checked = true;
        inputBox.value = "";
        submitBtn.onclick=()=>{
          const answer=inputBox.value.trim();
          if(!answer) return;
          socket.emit("submitAnswer",{roomCode,name:myName,questionId,answer});
          submitBtn.disabled=true;
          inputBox.disabled=true;
          document.getElementById("toggleSubmit").checked = false;
        };
      }
    });

    // ---- Server Event: allSubmitted ----
    // When server signals all players have submitted, enable Show Answers button.
    socket.on("allSubmitted", () => {
      showBtn.disabled=false;
      document.getElementById("toggleShow").checked = true;
    });

    // ---- Show Answers Button ----
    // Clicking this tells server to reveal answers.
    showBtn.onclick = () => {
      socket.emit("showAnswers",{roomCode});
      answersShown = true;
    };

    // ---- Server Event: answersRevealed ----
    // Server sends all answers for the round. Build table rows dynamically.
    socket.on("answersRevealed", rows => {
      const roundMap = toRoundMap(scoreboard, currentRound);
      document.querySelector("#answersTable tbody").innerHTML = rows
        .map(r => {
          const name = escapeHTML(r.name);
          const ans = escapeHTML(r.answer);
          const checked = roundMap[name] === 1 ? "checked" : "";
          const labelText = roundMap[name] === 1 ? "+1" : "0";
          const labelClass = roundMap[name] === 1 ? "pointLabel green" : "pointLabel blue";
          // Each row has: point toggle, unicorn radio, player name, answer text
          return `
            <tr>
              <td>
                <label class="switch">
                  <input type="checkbox" class="scoreToggle" data-player="${name}" data-round="${currentRound}" ${checked}>
                  <span class="slider"></span>
                  <span class="${labelClass}">${labelText}</span>
                </label>
              </td>
              <td>
                <input type="radio" name="unicornTag" class="unicornRadio"
                       data-player="${name}" data-round="${currentRound}" id="unicorn-${name}" ${r.tag === "ü¶Ñ" ? "checked" : ""}>
                <label for="unicorn-${name}" class="unicornLabel"></label>
              </td>
              <td>${name}</td>
              <td>${ans}</td>
            </tr>
          `;
        })
        .join("");

      // Show answers accordion, hide question accordion
      document.getElementById("answersAccordion").style.display="block";
      openAccordion("answersTableWrapper");
      closeAccordion("questionBox");

      // Reset button states for next round
      showBtn.disabled=true;
      document.getElementById("toggleShow").checked = false;
      startBtn.disabled=false;
      document.getElementById("toggleStart").checked = true;
      statusMessage.innerText="Round finished. You can start a new round.";
    });

    // ---- Persist Point Toggles ----
    // When host toggles a score checkbox, send update to server and update label text.
	document.addEventListener("change", e => {
	  if (e.target.classList.contains("scoreToggle")) {
	    const player = e.target.dataset.player;
	    const round = parseInt(e.target.dataset.round, 10);
	    const points = e.target.checked ? 1 : 0;
	
	     // Update label text and color immediately (optimistic UI update)
	    const labelSpan = e.target.closest("label").querySelector(".pointLabel");
	    if (labelSpan) {
	      labelSpan.textContent = points === 1 ? "+1" : "0";
	      labelSpan.className = points === 1 ? "pointLabel green" : "pointLabel blue";
	    }
	
	    // emit with acknowledgement
	    socket.emit("awardPoint", { roomCode, playerName: player, roundNumber: round, points }, (ack) => {
	      if (!ack.success) {
	        // revert if server failed
	        e.target.checked = !e.target.checked;
	        if (labelSpan) {
	          labelSpan.textContent = e.target.checked ? "+1" : "0";
	          labelSpan.className = e.target.checked ? "pointLabel green" : "pointLabel blue";
	        }
	        alert("Failed to update score. Please try again.");
	      }
	    });
	  }
	});
	  

    // ---- Server Event: scoreboardUpdated ----
    // Server sends updated scoreboard. Re-render table and sync toggles.
	/* if (document.getElementById("answersAccordion").style.display === "block") {
  		// sync toggles
		} //} That means if the accordion isn‚Äôt open, you skip syncing. Remove that condition so toggles always sync.
	*/

	// ---- Server Event: scoreboardUpdated ----
	// Server sends updated scoreboard. Re-render table and sync toggles.
	socket.on("scoreboardUpdated", data => {
	  scoreboard = data || [];
	  renderScoreboard(scoreboard);
	
	  // Always sync toggles, regardless of accordion state
	  const roundMap = toRoundMap(scoreboard, currentRound);
	  document.querySelectorAll(".scoreToggle").forEach(cb => {
	    const player = cb.dataset.player;
	    cb.checked = roundMap[player] === 1;
	    const labelSpan = cb.closest("label").querySelector(".pointLabel");
	    if (labelSpan) {
	      labelSpan.textContent = cb.checked ? "+1" : "0";
	      labelSpan.className = cb.checked ? "pointLabel green" : "pointLabel blue";
	    }
	  });
	});

// ---- Render Scoreboard ----
// Builds scoreboard table dynamically based on server data.
function renderScoreboard(data) {
  // Find maximum round number across all players
  const allRounds = data.flatMap(d =>
    Object.keys(d.rounds || {}).map(n => parseInt(n, 10))
  );
  const maxRound = Math.max(0, ...allRounds);

  // Build header row with TAG, Player, Total, and round numbers
  const header =
    "<tr><th>TAG</th><th>Player</th><th>Total</th>" +
    Array.from({ length: maxRound }, (_, i) => `<th>#${i + 1}</th>`).join("") +
    "</tr>";
  document.querySelector("#scoreTable thead").innerHTML = header;

  // Build each player row
  const rows = data
    .map(d => {
      const total = d.total || 0;
      const roundCells = Array.from({ length: maxRound }, (_, i) => {
        const rnum = i + 1;
        const val = (d.rounds && d.rounds[rnum]) != null ? d.rounds[rnum] : 0;
        return `
          <td class="roundCell">
            <select data-player="${escapeHTML(d.player_name)}" data-round="${rnum}" class="scoreSelect">
              <option value="0" ${val == 0 ? "selected" : ""}>0</option>
              <option value="1" ${val == 1 ? "selected" : ""}>1</option>
            </select>
          </td>
        `;
      }).join("");

      // TAG column shows ü¶Ñ if player has unicorn tag
      return `<tr><td>${d.tag ? d.tag : ""}</td><td>${escapeHTML(d.player_name)}</td><td>${total}</td>${roundCells}</tr>`;
    })
    .join("");

  document.querySelector("#scoreTable tbody").innerHTML = rows;


  // Dynamic min-width so table scrolls horizontally if many rounds
  const baseWidth = 270; // Tag (40) + Player (150) + Total (80)
  const roundWidth = 55; // width for each round column
  const minWidth = baseWidth + (maxRound - 1) * roundWidth;
  document.querySelector("#scoreTable").style.minWidth = minWidth + "px";
}

// ---- Global delegated listener ----
// Attach once, outside renderScoreboard
document.addEventListener("change", e => {
  if (e.target.classList.contains("scoreSelect")) {
    const player = e.target.dataset.player;
    const round = parseInt(e.target.dataset.round, 10);
    const points = parseInt(e.target.value, 10);
    socket.emit("awardPoint", { roomCode, playerName: player, roundNumber: round, points });
  }
});



    // ---- Utility Functions ----
    // Map scoreboard data to round points for quick lookup
    function toRoundMap(data, round) {
      const map = {};
      (data || []).forEach(d => {
        const val = (d.rounds && d.rounds[round]) != null ? d.rounds[round] : 0;
        map[escapeHTML(d.player_name)] = parseInt(val, 10) === 1 ? 1 : 0;
      });
      return map;
    }

    // Escape HTML to prevent injection attacks
    function escapeHTML(str){
      const div=document.createElement('div');
      div.innerText=String(str||"");
      return div.innerHTML;
    }

    // Accordion helpers
    function toggleAccordion(id){document.getElementById(id).classList.toggle("open");}
    function openAccordion(id){document.getElementById(id).classList.add("open");}
    function closeAccordion(id){document.getElementById(id).classList.remove("open");}

    // ---- Popup Logic ----
    // Close popup when clicking X or background
    document.getElementById("closePopup").onclick = () => {
      document.getElementById("roundPopup").style.display = "none";
    };
    document.getElementById("roundPopup").addEventListener("click", e => {
      if (e.target.id === "roundPopup") {
        document.getElementById("roundPopup").style.display = "none";
      }
    });
	
	// Escape key closes popup
	document.addEventListener("keydown", e => {
	  if (e.key === "Escape") {
	    document.getElementById("roundPopup").style.display = "none";
	  }
	});

	  
    // Show Question button opens popup with current question
    const showQuestionBtn = document.getElementById("showQuestionBtn");
    showQuestionBtn.onclick = () => {
		const promptText = document.getElementById("questionPrompt").innerText;
		document.getElementById("popupQuestion").innerText = escapeHTML(promptText);
      	document.getElementById("roundPopup").style.display = "flex";
    };


    // ---- Unicorn Assignment ----
    // When a unicorn radio is selected, notify server and update scoreboard.
    document.addEventListener("change", e => {
      if (e.target.classList.contains("unicornRadio")) {
        const player = e.target.dataset.player;
        const round = parseInt(e.target.dataset.round, 10);

        // Tell server which player is unicorn
        socket.emit("assignUnicorn", { roomCode, playerName: player, roundNumber: round });

        // Optimistic update: clear all unicorns locally, then set selected
        scoreboard.forEach(p => p.tag = "");
        const target = scoreboard.find(p => p.player_name === player);
        if (target) target.tag = "ü¶Ñ";
        renderScoreboard(scoreboard);
      }
    });

    // ---- Unicorn Control Toggle + Clear Button ----
    const toggleUnicorn = document.getElementById("toggleUnicorn");
    const clearUnicornBtn = document.getElementById("clearUnicornBtn");

    // Show/hide Clear Unicorn button depending on toggle state
    toggleUnicorn.addEventListener("change", e => {
      clearUnicornBtn.style.display = e.target.checked ? "inline-block" : "none";
    });

    // Clear unicorn assignment for all players when button clicked
    clearUnicornBtn.onclick = () => {
      if (confirm("Clear unicorn tag for this room?")) {
        socket.emit("clearUnicorn", { roomCode });

        // Optimistic update: clear all unicorns locally
        scoreboard.forEach(p => p.tag = "");
        renderScoreboard(scoreboard);

        // Also clear radios in the answers table
        document.querySelectorAll(".unicornRadio").forEach(radio => {
          radio.checked = false;
        });
      }
    };
  </script>
</body>
</html>

